meta {
  name: createCredentialDef
  type: http
  seq: 5
}

post {
  url: {{ISSUER_ISS_API}}/v1alpha/participants/{{B64_ISS_ID}}/credentialdefinitions
  body: json
  auth: inherit
}

body:json {
  {
    "attestations": ["MC-Attestation"],
    "credentialType": "MembershipCredential",
    "format": "VC1_0_JWT",
    "id": "MC-Cred-Def",
    "jsonSchema": "{}",
    "jsonSchemaUrl": "",
    "mappings": [
    ],
    "validity": 15552000
  }
}

script:pre-request {
  const btoa = require("btoa");
  const iss_id = bru.getEnvVar("ISS_ID");
  bru.setEnvVar("B64_ISS_ID", btoa(iss_id));
  
  req.setHeader("x-api-key", bru.getEnvVar("ISSUER_APIKEY"));
}

settings {
  encodeUrl: true
  timeout: 0
}

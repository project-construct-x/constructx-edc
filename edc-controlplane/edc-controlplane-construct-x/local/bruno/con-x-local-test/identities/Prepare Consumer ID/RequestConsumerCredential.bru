meta {
  name: RequestConsumerCredential
  type: http
  seq: 3
}

post {
  url: {{CONSUMER_IDHUB_ID_API}}/v1alpha/participants/{{B64_CONS_ID}}/credentials/request
  body: json
  auth: none
}

body:json {
  {
      "issuerDid": "{{ISS_ID}}",
      "credentials": [{
          "format": "VC1_0_JWT",
          "type": "MembershipCredential", 
          "id": "MC-Cred-Def"
      }]
  }
}

script:pre-request {
  const btoa = require("btoa");
  const cons_id = bru.getEnvVar("CONS_ID");
  bru.setEnvVar("B64_CONS_ID", btoa(cons_id));
  req.setHeader("x-api-key", bru.getEnvVar("CONSUMER_IH_APIKEY"));
}

settings {
  encodeUrl: true
  timeout: 0
}
